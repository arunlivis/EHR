var Data = require('../EHR_Json/data.json')

var id;
var user_name;

module.exports={
    login : function (browser) {
        browser 
        .login(Data.user1[1].username, Data.user1[1].password)

},
'Get User Name':function(browser){
	browser
	 .useCss()
	 .pause(500)
	 .click('a[class="firstLevel"]')
	 .pause(300)
	 .click('a[href="/EHR/Clinicadmin/view-patient-details-open"]')
	 .waitForElementVisible('a[onclick="getPatientProfile()"]' , 60000)
	 .pause(500)
	 .getText('td[class="sorting_1"]' , function(result){
	 	id=result.value
	 	browser
	 	  .click('a[onclick="postNavigateToProfile('+result.value+',1);"]')
	 })
	 browser
	   .waitForElementVisible('#patient_first_name' , 60000)
	   .pause(500)
	   .getText('#usernameId' , function(result){
	   	   user_name=result.value.substr(11)
	   })
},
'Consent to Treat a Minor':function(browser){
  browser
    .useCss()
    .getAttribute('#date_of_birth' , 'value' , function(result){
          var birthdate = new Date(result.value);
          var cur = new Date();
          var diff = cur-birthdate; // This is the difference in milliseconds
          var age = Math.floor(diff/31536000000); // Divide by 1000*60*60*24*365
          
                   browser
                       .pause(500)
                       .click('a[href="/EHR/EHR/j_spring_security_logout"]')
                       .waitForElementVisible('#username_id' , 60000)
                       .pause(500)
                       .useCss()
	                   .pause(500)
	                   .setValue('#username_id' , user_name)
	                   .setValue('#password_id' , user_name)
	                   .pause(300)
	                   .click('button[class="btn btn-primary"][type="submit"]')
	                   .waitForElementVisible('a[class="firstLevel"][href="/EHR/Patient/patient-dashboard"]' , 60000)
	                   .pause(500)
	                        .isVisible('#myModal' , function(result){
	  	                       if(result.value==true){
	  	                    	     browser
	  	                    	      .setValue('#password' , user_name)
	  	                    	      .setValue('#confirmpassword' , user_name)
	  	                    	      .pause(500)
	  	                    	      .click('button[onclick="return savepassword()"]')
	  	                    	      .waitForElementNotVisible('#myModal' , 60000)
	  	                    	      .pause(500)
	  	                       }
	                        })
                       .useCss()
	                   .pause(500)
	                   .waitForElementVisible('a[href="/EHR/Patient-Details/profile"]' , 60000)
	                   .click('a[href="/EHR/Patient-Details/profile"]')
	                   .waitForElementVisible('#patient_first_name' , 60000)
	                   .pause(500)
                       .click('a[onclick="getDefaultFormList();"]')
            if(age<18){
                   browser           
	                   .useXpath()
	                   .waitForElementVisible("//*[@id='formsContent']/div/div/a[text()='Consent to Treat a Minor']" , 60000)
	                   .pause(500)
	                   .pause(500)
                       .verify.elementPresent("//*[@id='formsContent']/div/div/a[text()='Consent to Treat a Minor']")
                       .pause(500)
                       .useXpath()
                       .click("//*[@id='formsContent']/div/div/a[text()='Consent to Treat a Minor']")
                       .useCss()
                       .waitForElementVisible('button[onclick="getDefaultFormList()"]' , 60000)
                       .pause(1000)
                       .getLocationInView('button[class="btn btn-primary submit-btn requestRecHidden uncompletedVisible"][type="submit"]')
                       .pause(2000)
                       .getLocationInView('button[onclick="getDefaultFormList()"]')
                       .pause(1000)
                       .click('#acceptstatement_id')
                       .pause(500)
                       .getLocationInView('button[class="btn btn-primary submit-btn requestRecHidden uncompletedVisible"][type="submit"]')
                       .pause(500)
                       .getLocationInView('#acceptstatement_id')
                       .pause(500)
                       .click('button[class="btn btn-primary submit-btn requestRecHidden uncompletedVisible"][type="submit"]')
                       .waitForElementVisible('a[onclick="getDefaultFormList();"]' , 60000)
	                   .useXpath()
                       .pause(500)
                       .verify.elementNotPresent("//*[@id='formsContent']/div/div/a[text()='Consent to Treat a Minor']")
                       .pause(500)
                       .useCss()
                       .click('a[href="/EHR/EHR/j_spring_security_logout"]')
                       .waitForElementVisible('#username_id' , 60000)
                       .pause(500)
                       .useCss()
	                   .pause(500)
	                   .setValue('#username_id' , Data.user1[1].username)
	                   .setValue('#password_id' , Data.user1[1].password)
	                   .pause(300)
	                   .click('button[class="btn btn-primary"][type="submit"]')
	                   .waitForElementVisible('a[class=""]' , 60000)
	                   .pause(500)
	                   .click('a[class="firstLevel"]')
	                   .pause(300)
	                   .click('a[href="/EHR/Clinicadmin/view-patient-details-open"]')
	                   .waitForElementVisible('a[onclick="getPatientProfile()"]' , 60000)
	                   .pause(500)
	                   .click('a[onclick="postNavigateToProfile('+id+',1);"]')
	                   .waitForElementVisible('#patient_first_name' , 60000)
	                   .pause(500)
	                   .click('a[onclick="getDefaultFormList();"]')
	                   .useXpath()
	                   .waitForElementVisible("//*[@id='formsContent']/div/div/a[text()='Confidential Patient Information']" , 60000)
	                   .pause(1000)
                       .useCss()
                       .getLocationInView('#mainFooter')
                       .pause(500)
                       .useXpath()
                       .pause(500)
                       .getLocationInView("//*[@id='formsContent']/div/div/a[text()='Consent to Treat a Minor']")
                       .pause(500)
                       .getLocationInView("//*[@id='formsContent']/div/div/a[text()='Confidential Patient Information']")
                       .pause(1000)
                       .click("//*[@id='formsContent']/div/div/a[text()='Consent to Treat a Minor']")
                       .useCss()
                       .waitForElementVisible('#btnExportPatientForm' , 60000)
                       .pause(500)
                       .getLocationInView('button[class="btn btn-primary submit-btn requestRecHidden uncompletedVisible"][type="submit"]')
                       .pause(1000)
                       .getLocationInView('#btnExportPatientForm')
                       .pause(500)
                       .getAttribute('#acceptstatement_id' , 'checked' , function(result){
                             this
                             .pause(500)
                             .verify.visible('[id="acceptstatement_id"][checked="checked"]')
                       })
            
            }
          if(age>=18){
            browser
                       .pause(1500)
                       .useXpath()
                       .verify.elementNotPresent("//*[@id='formsContent']/div/div/a[text()='Consent to Treat a Minor']")

              
          }
    })
    browser
    .pause(500)
    .end()
    }  
  }  	   
var Data = require('../EHR_Json/data.json')

var id;
var Day = new Date();
var today = Day.getDay()
var mgn_start;
var mgn_end;
var eve_start;
var eve_end;

var arr=[];

var last_name;
var first_name;
var appointmentDescription;
var appointment_1=[];
var time=[];
var ae;

module.exports={
    login : function (browser) {
        browser 
        .login(Data.user1[1].username, Data.user1[1].password)

},
'Set Clinic Hours':function(browser){
  browser
     .useCss()
     .click('a[class=""]')
     .pause(500)
     .click('a[href="/EHR/Clinicadmin/clinicadmin-settings"]')
     .waitForElementVisible('#patientsCount' , 60000)
     .pause(500)
     .getValue('#slotDurationId' , function(result){
          value=result.value
     })
     if(today==0){
        browser 
               .getValue('#startTimeSun' , function(result){
                   mgn_start=result.value
               })
               .getValue('#breakStartTimeSun' , function(result){
                   mgn_end=result.value
               })
               .getValue('#breakEndTimeSun' , function(result){
                   eve_start=result.value
               })
               .getValue('#endTimeSun' , function(result){
                   eve_end=result.value
               })
     }
     if(today==1){
        browser 
               .getValue('#startTimeMon' , function(result){
                   mgn_start=result.value
               })
               .getValue('#breakStartTimeMon' , function(result){
                   mgn_end=result.value
               })
               .getValue('#breakEndTimeMon' , function(result){
                   eve_start=result.value
               })
               .getValue('#endTimeMon' , function(result){
                   eve_end=result.value
               })
     }
     if(today==2){
        browser 
               .getValue('#startTimeTue' , function(result){
                   mgn_start=result.value
               })
               .getValue('#breakStartTimeTue' , function(result){
                   mgn_end=result.value
               })
               .getValue('#breakEndTimeTue' , function(result){
                   eve_start=result.value
               })
               .getValue('#endTimeTue' , function(result){
                   eve_end=result.value
               })
     }
     if(today==3){
        browser 
               .getValue('#startTimeWed' , function(result){
                   mgn_start=result.value
               })
               .getValue('#breakStartTimeWed' , function(result){
                   mgn_end=result.value
               })
               .getValue('#breakEndTimeWed' , function(result){
                   eve_start=result.value
               })
               .getValue('#endTimeWed' , function(result){
                   eve_end=result.value
               })
     }
     if(today==4){
        browser 
               .getValue('#startTimeThu' , function(result){
                   mgn_start=result.value
               })
               .getValue('#breakStartTimeThu' , function(result){
                   mgn_end=result.value
               })
               .getValue('#breakEndTimeThu' , function(result){
                   eve_start=result.value
               })
               .getValue('#endTimeThu' , function(result){
                   eve_end=result.value
               })
     }
     if(today==5){
        browser 
               .getValue('#startTimeFri' , function(result){
                   mgn_start=result.value
               })
               .getValue('#breakStartTimeFri' , function(result){
                   mgn_end=result.value
               })
               .getValue('#breakEndTimeFri' , function(result){
                   eve_start=result.value
               })
               .getValue('#endTimeFri' , function(result){
                   eve_end=result.value
               })
     }
     if(today==6){
        browser 
               .getValue('#startTimeSat' , function(result){
                   mgn_start=result.value
               })
               .getValue('#breakStartTimeSat' , function(result){
                   mgn_end=result.value
               })
               .getValue('#breakEndTimeSat' , function(result){
                   eve_start=result.value
               })
               .getValue('#endTimeSat' , function(result){
                   eve_end=result.value
               })
     }
},
'working hours':function(browser){
    browser


    var c=mgn_end.substring(0, 2)

var g=parseInt(mgn_start.substring(0, 2))
var d=parseInt(mgn_end.substring(0, 2))

var h;
var f;

var a2;
var b2;

       if(mgn_start.substring(6, 9)=='PM' && g<12){
  h=((g+12)+':'+mgn_start.substring(3, 5))
}else{
  h=mgn_start.substring(0, 5)
}

if(mgn_end.substring(6, 9)=='PM' && d<12){
  f=((d+12)+':'+mgn_end.substring(3, 5))
}else{
  f=mgn_end.substring(0, 5)
}




a2 = new Date("2015-01-01 "+h+":00")
b2 = new Date("2015-01-01 "+f+":00")

a1=a2.getTime();
b1=b2.getTime();



i=a1;
do{
  var date = new Date(i);
  var hours = date.getHours();
    var minutes = date.getMinutes();
    var ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 24;
    hours = hours ? hours : 24; // the hour '0' should be '12'
    minutes = minutes < 10 ? '0'+minutes : minutes;
    if(hours<10){
    var strTime = '0' + hours + ':' + minutes;
  }else{
    var strTime = hours + ':' + minutes;
  }
  arr.push(strTime);
    i=i+(value*60000);
}
while(i<b1)
  //----------------------------------------------------------------------------------------

    var c_1=eve_end.substring(0, 2)

var g_1=parseInt(eve_start.substring(0, 2))
var d_1=parseInt(eve_end.substring(0, 2))

var h_1;
var f_1;

var a2_1;
var b2_1;

       if(eve_start.substring(6, 9)=='PM' && g_1<12){
  h_1=((g_1+12)+':'+eve_start.substring(3, 5))
}else{
  h_1=eve_start.substring(0, 5)
}

if(eve_end.substring(6, 9)=='PM' && d_1<12){
  f_1=((d_1+12)+':'+eve_end.substring(3, 5))
}else{
  f_1=eve_end.substring(0, 5)
}




a2_1 = new Date("2015-01-01 "+h_1+":00")
b2_1 = new Date("2015-01-01 "+f_1+":00")

a1_1=a2_1.getTime();
b1_1=b2_1.getTime();



i_1=a1_1;
do{
  var date_1 = new Date(i_1);
  var hours_1 = date_1.getHours();
    var minutes_1 = date_1.getMinutes();
    var ampm_1 = hours_1 >= 12 ? 'PM' : 'AM';
    hours_1 = hours_1 % 24;
    hours_1 = hours_1 ? hours_1 : 24; // the hour '0' should be '12'
    minutes_1 = minutes_1 < 10 ? '0'+minutes_1 : minutes_1;
    if(hours_1<10){
    var strTime_1 = '0' + hours_1 + ':' + minutes_1;
  }else{
    var strTime_1 = hours_1 + ':' + minutes_1;
  }
  arr.push(strTime_1);
    i_1=i_1+(value*60000);
}
while(i_1<b1_1)
},
'open patient file':function(browser){
  browser
    .useCss()
   .pause(500)
   .click('a[class="firstLevel"]')
   .pause(300)
   .click('a[href="/EHR/Clinicadmin/view-patient-details-open"]')
   .waitForElementVisible('a[onclick="getPatientProfile()"]' , 60000)
   .pause(1000)
   .waitForElementVisible('td[class="sorting_1"]' , 60000)
   .pause(500)
   .getText('td[class="sorting_1"]' , function(result){
    id=result.value
      browser
         .click('a[onclick="postNavigateToProfile('+result.value+',1);"]')
         .waitForElementVisible('#patient_first_name' , 60000)
   })
  browser
   .pause(500)
   .getValue('#patient_last_name' , function(result){
         last_name=result.value
   })
   .getValue('#patient_first_name' , function(result){
         first_name=result.value
   })
   .pause(500)
   .click('a[href="/EHR/EHR/j_spring_security_logout"]')
   .waitForElementVisible('#username_id' , 60000)
   .pause(500)
  
    
},
'Doctor Login':function(browser){
  var patient_name=last_name + ' ' + first_name

   ae=Math.floor((Math.random()*arr.length)+1)
af=['fever' , 'leg pain' , 'foot pain']
appointmentDescription=af[Math.floor(Math.random()*af.length)]


  browser
    .setValue('#username_id' , Data.user1[2].username)
    .setValue('#password_id' , Data.user1[2].password)
    .pause(500)
    .click('button[class="btn btn-primary"][type="submit"]')
    .waitForElementVisible('a[class="firstLevel"]' , 60000)
    .pause(500)
    .useXpath()
    .click("//*[@id='calendar']/div[2]/div/table/tbody/tr/td/div/div/div[2]/table/tbody/tr[5]/td[2]")
    .useCss()
    .waitForElementVisible('#addAppointmentModal' , 60000)
    .pause(500)
    .setValue('#regularPatientName' , patient_name)
    .pause(500)
    .waitForElementVisible('li[data-value="'+patient_name +' - '+ id+'"]' , 60000)
    .pause(500)
    .click('li[data-value="'+patient_name +' - '+ id+'"]')
    .pause(500)
    .click('#addAppointmentTime')
   
browser
       .useCss()
       .pause(1000)
       .click('input[value="'+arr[ae-1]+'"][name="booking"]')
       .pause(500)
       .clearValue('#appointmentDescription')
       .setValue('#appointmentDescription' , appointmentDescription)
       .pause(500)
       .click('#eventUrl-addName')
       .pause(1000)
       .waitForElementNotVisible('#addAppointmentModal' , 60000)
       .pause(500)
       .click('#username_label')
       .pause(500)
       .click('a[href="/EHR/EHR/j_spring_security_logout"]')
       .waitForElementVisible('#username_id' , 60000 , function(result){
            var timeString = arr[ae-1];
            var H = +timeString.substr(0, 2);
            var h = (H % 12) || 12;
            var ampm = H < 12 ? "AM" : "PM";
            zzzz = h + timeString.substr(2, 3) + ' ' +ampm;
            appointment_1.push(zzzz)
       })
       browser
       .pause(500)


},
'Admin Login':function(browser){
  browser
    .setValue('#username_id' , Data.user1[1].username)
    .setValue('#password_id' , Data.user1[1].password)
    .pause(500)
    .click('button[class="btn btn-primary"][type="submit"]')
    .waitForElementVisible('a[class="firstLevel"]' , 60000)
    .pause(500)
    .useCss()
   .pause(500)
   .click('a[class="firstLevel"]')
   .pause(300)
   .click('a[href="/EHR/Clinicadmin/view-patient-details-open"]')
   .waitForElementVisible('a[onclick="getPatientProfile()"]' , 60000)
   .pause(1000)
   .waitForElementVisible('td[class="sorting_1"]' , 60000)
   .pause(500)
   .click('a[onclick="postNavigateToProfile('+id+',1);"]')
   .waitForElementVisible('#patient_first_name' , 60000)
   .pause(500)
   .click('a[onclick="loadDatatable()"]')
   .waitForElementVisible('button[onclick="openAppointmentWindow();"]' , 60000)
   .pause(500)
   .elements('css selector', 'table#appointment tbody tr', function(result) {
           for(i=1; i<=result.value.length; i++){
                 browser
                    .useXpath()
                    .getText("//*[@id='appointment']/tbody/tr["+i+"]/td[4]" , function(result){
                          time.push(result.value)
                    })
           }
       })
   browser
   .pause(500)
   .end()
},
'Check':''+function(browser){
  browser
  .pause(500)
  .verify.equal(time[time.indexOf(appointment_1[0])] , appointment_1[0])
     // if((time.join()).indexOf(appointment_1) > -1){
     //  console.log('appointment---->True')
     // }else{
     //  console.log('appointment---->False')
     // }
     console.log(time)
     console.log(appointment_1)
     console.log(time.indexOf(appointment_1[0]))
}
}       
var Data = require('../EHR_Json/data.json')

var cpt_code=[];
var soap=[];

var bill_1=[];
var bill_2=[];

var sum_1;
var sum_2;
var sum_3;


module.exports={
    login : function (browser) {
        browser 
        .login(Data.user1[1].username, Data.user1[1].password)

},
'view files' : function (browser){
      browser
       .pause(1000)      
       .useCss()
       .click('a[class="firstLevel"]')
       .pause(500)
       .click('a[href="/EHR/Clinicadmin/view-patient-details-open"]')
       .waitForElementVisible('#col0_filter' , 60000)
       .useXpath()
       .pause(200)
       .click("//*[@id='patient']/tbody/tr/td[6]/a/i")
       .useCss()
       .waitForElementVisible('#patient_first_name' , 60000)
       .pause(500)
},
'Exam form':function(browser){
  browser
      .useCss()
      .pause(500)
      .click('a[onclick="doGetTreatments();"]')
      .waitForElementVisible('button[onclick="openStartTreatment();"]' , 60000)
      .pause(500)
},
'Treatment plan 1':function(browser){
    browser      
      .useXpath()
      .click("//*[@id='treatmentformsContent']/div[2]/span/button")
      .useCss()
      .waitForElementVisible('button[onclick="addSoapNotes();"]' , 60000)
      .pause(500)
      .useXpath()
      .getLocationInView("//*[@id='treatmentformsContent']/div/a[text()='Initial Exam Screen 8 -']")
      .pause(500)
      .getLocationInView("//*[@id='treatmentformsContent']/div/a[text()='Initial Exam Screen 6 -']")
      .pause(500)
      .click("//*[@id='treatmentformsContent']/div/a[text()='Initial Exam Screen 8 -']")
      .useCss()
      .waitForElementVisible('#btnExportTreatmentForm' , 60000)
      .pause(500)

      for(i=1; i<=14; i++){
      var a27=(function(){
        var j=i
        return function(result){
            if(result.value=="true"){
                   browser
                        .useCss()
                        .pause(300)
                        .getValue('#treatmentPlan'+j+'' , function(result){
                           cpt_code.push(result.value)
                        })
          }
        }})()
        browser
      .getAttribute('#treatmentPlan'+i+'' , 'checked' , a27)
      }
      browser
       .pause(500)
       .click('button[onclick="gobackExamsList()"]')
       .useXpath()
       .waitForElementVisible("//*[@id='treatmentformsContent']/div/a[text()='Initial Exam Screen 8 -']" , 60000)
       .pause(500)
       .getLocationInView("//*[@id='treatmentformsContent']/div/a[text()='Initial Exam Screen 7 -']")
       .pause(500)
       .click("//*[@id='treatmentformsContent']/div/a[text()='Radiological Report -']")
       .useCss()
       .waitForElementVisible('#btnExportTreatmentForm' , 60000)
       .pause(500)
       .bill(cpt_code)
       .pause(500)
       .click('button[onclick="gobackExamsList()"]')
       .useXpath()
       .waitForElementVisible("//*[@id='treatmentformsContent']/div/a[text()='Initial Exam Screen 8 -']" , 60000)
       .pause(500)



       .getLocationInView("//*[@id='treatmentformsContent']/div/a[text()='Initial Exam Screen 8 -']")
       .click("//*[@id='treatmentformsContent']/div/a[text()='SOAP Notes -']")
       .useCss()
       .waitForElementVisible('#patient_name' , 60000)
       .pause(500)
       
       

      aa=['97010' , '97014' , '97035' , '97110' , '97112' , '97122' , '97124' , '97140' , '97265' , '97504' , '98940' , '98941' , '98943' , '99201' ,'S9090']
        for(i=0; i<aa.length; i++){
      var a27=(function(){
        var j=i
        return function(result){
            if(result.value=="true"){
                   soap.push(aa[j])
          }
        }})()
        browser
      .getAttribute('input[name="cptcodes"][value="'+aa[i]+'"]' , 'checked' , a27)
      }

      browser
        .pause(500)
        .useCss()
        .click('button[class="close hidden-print"]')
        .useXpath()
        .waitForElementVisible("//*[@id='treatmentformsContent']/div/a[text()='Initial Exam Screen 8 -']" , 60000)
        .pause(500)

      

},
'Billing':function(browser){
  browser
     .useCss()
     .pause(1000)
     .click('i[class="fa fa-usd fa-fw"]')
     .pause(300)
     .click('a[href="/EHR/Clinicadmin/ICDCodes"]')
     .waitForElementVisible('a[href="/EHR/Clinicadmin/viewDiscount"]' , 60000)
     .pause(500)
     .click('a[href="/EHR/Clinicadmin/viewFeeSchedule"]')
     .pause(1000)
     for(i=0 ; i<cpt_code.length; i++){
      browser
       .pause(200)
     .clearValue('input[placeholder="Search CPT Codes"]')
     .setValue('input[placeholder="Search CPT Codes"]' , cpt_code[i])
     .pause(500)
     .getText('#content_'+cpt_code[i]+'' , function(result){
      bill_1.push(result.value)
     })
     
   }
   browser
     .clearValue('input[placeholder="Search CPT Codes"]')
     .setValue('input[placeholder="Search CPT Codes"]' , '99203')
     .pause(500)
     .getText('#content_99203' , function(result){
      bill_1.push(result.value)
      sum_3=result.value
     })


     for(i=0 ; i<soap.length; i++){
      browser
       .pause(200)
     .clearValue('input[placeholder="Search CPT Codes"]')
     .setValue('input[placeholder="Search CPT Codes"]' , soap[i])
     .pause(500)
     .getText('#content_'+soap[i]+'' , function(result){
      bill_2.push(result.value)
     })
     
   }

},
'Billing History':function(browser){
 
	browser
     .useCss()
     .pause(500)
     .click('a[class="firstLevel"]')
     .pause(300)
     .click('a[href="/EHR/Clinicadmin/view-patient-details-open"]')
     .waitForElementVisible('#col0_filter' , 60000)
     .useXpath()
     .pause(500)
     .waitForElementVisible("//*[@id='patient']/tbody/tr/td[6]/a/i" , 60000)
     .pause(500)
     .click("//*[@id='patient']/tbody/tr/td[6]/a/i")
     .useCss()
     .waitForElementVisible('#patient_first_name' , 60000)
     .pause(500)

	   .click('a[onclick="getBillingDetails();"]')
	   .waitForElementVisible('button[onclick="getReceipts();"]' , 60000)
	   .pause(500)
		.elements('css selector', 'table#billing tbody tr', function(result) {
      if(bill_2.length != 0){
           console.log("Table rows---->"+[Number(result.value.length)==3])
         }else{
           console.log("Table rows---->"+[Number(result.value.length)==2])
         }
		})

},
'Bill':function(browser){
   sum_1 = (bill_1.map(Number)).reduce(function(a, b) { return a + b; }, 0);
   sum_2 = (bill_2.map(Number)).reduce(function(a, b) { return a + b; }, 0);
	browser
     .useXpath()
     .click("//*[@id='billing']/thead/tr/th[3]")
     .pause(500)
     .verify.containsText("//*[@id='billing']/tbody/tr[1]/td[4]" , sum_3)
     .verify.containsText("//*[@id='billing']/tbody/tr[2]/td[4]" , sum_1)
     if(bill_2.length != 0){
      browser
          .verify.containsText("//*[@id='billing']/tbody/tr[3]/td[4]" , sum_2)
     }
   browser
     .pause(500)
     .end()
}
}



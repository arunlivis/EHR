var Data = require('../EHR_Json/data.json')
var form = require('../EHR_Json/examform8.json')
var auto=[];
var trt=[];              var trt_11=[];
var shortT=[];           var shortT_11=[];
var longT=[];            var longT_11=[];
var asses_1;
var asses_2;
var freq;
var shot_other=[];       var shot_other_11=[];
var long_other=[];       var long_other_11=[];

module.exports={
	login : function (browser) {
		browser 
		.login(Data.user1[1].username, Data.user1[1].password)
},
'view files' : function (browser){
      browser
      .pause(1000)      
       .useCss()
       .click('a[class="firstLevel"]')
       .pause(500)
       .click('a[href="/EHR/Clinicadmin/view-patient-details-open"]')
       .waitForElementVisible('#col0_filter' , 60000)
       .useXpath()
       .pause(200)
       .click("//*[@id='patient']/tbody/tr/td[6]/a/i")
       .useCss()
       .waitForElementVisible('#patient_first_name' , 60000)
       .pause(500)
       
     },
'Patient Intake Form' : function (browser){
	browser
	.useXpath()
	.pause(500)
	.click("//*[@id='formtab']/a")
	.waitForElementVisible("//*[@id='formsContent']/div/div/a[text()='Confidential Patient Information']" , 60000)
	.pause(200)
	.click("//*[@id='formsContent']/div/div/a[text()='Confidential Patient Information']")
	.useCss()
    .waitForElementVisible('#cpiDate' , 60000)
    .pause(500)
	.getAttribute('#areSymptomsDueToAccident_id' , 'checked' , function(result){
		if(result.value=="true"){
			browser
			.getAttribute('#auto' , 'checked' , function(result){
				if(result.value=="true"){
					auto.push(1)
				}
				
			})
			
		}
		
	})
	browser
	.useCss()
	.pause(500)
},
'Exam Forms' : function(browser){
  browser
       .pause(2000)
       .useCss()
       .click('a[onclick="doGetTreatments();"]')
       .waitForElementVisible('button[onclick="openStartTreatment();"]' , 60000)
       .pause(500)
},
'Treatment Plan 1' : function (browser){
  browser
      .pause(2000)
      .useXpath()
      .click("//*[@id='treatmentformsContent']/div[2]/span/button")
      .useCss()
      .waitForElementVisible('button[onclick="addSoapNotes();"]' , 60000)
      .pause(500)
},
'Initial Exam Screen 8' : function (browser){
  asses_1=Math.floor((Math.random()*5)+1)
  asses_2=Math.floor((Math.random()*3)+1)
  freq=Math.floor((Math.random()*7)+1)
  browser
        .useXpath()
        .pause(500)
        .getLocationInView("//*[@id='treatmentformsContent']/div/a[text()='Initial Exam Screen 8 -']")
        .pause(500)
        .getLocationInView("//*[@id='treatmentformsContent']/div/a[text()='Initial Exam Screen 5 -']")
        .pause(500)
        .click("//*[@id='treatmentformsContent']/div/a[text()='Initial Exam Screen 8 -']")
        .useCss()
        .waitForElementVisible('button[onclick="gobackExamsList()"]' , 60000)
        .pause(500)
        .exam8(trt , shortT, longT, shot_other, long_other)
        .pause(500)
        .getLocationInView('#diagnosisTen_id')
        .pause(500)
        .getLocationInView('button[onclick="gobackExamsList()"]')
        .pause(500)
        .click('input[name="assessment"][value="'+asses_1+'"]')
        .click('input[name="assessmentLevel"][value="'+asses_2+'"]')
        .pause(500)
        .getLocationInView('#shortTermDecreasePain_id')
        .pause(500)
        .getLocationInView('#diagnosisTen_id')
        .pause(500)

        for(i=0; i<7; i++){
          a=Math.floor((Math.random()*14)+0)
          trt.push(a)
          browser
             .click('#'+form.treat[a]+'')
        }

        browser
        .pause(500)
        .click('input[name="frequencyOfCare"][value="'+freq+'"]')

        for(i=0; i<3; i++){
          b=Math.floor((Math.random()*6)+0)
          shortT.push(b)
          browser
             .click('#'+form.short[b]+'')
             if(form.short[b]=='other_id'){
                 browser
                 .pause(500)
                   .isVisible('#shortTermOtherText_id' , function(result){
                       if(result.value==true){
                        c=['Pain' , 'Spasm' , 'ROM' , 'ADL' , 'Subluxations']
                        sh_te=c[Math.floor(Math.random()*c.length)]
                        shot_other.push(sh_te)
                           browser
                             .clearValue('#shortTermOtherText_id')
                             .setValue('#shortTermOtherText_id' , sh_te)
                       }
                   })
             }
        }

        for (i = 0; i <1; i++) {
          c=3//Math.floor((Math.random()*4)+0)
          longT.push(c)
          browser
             .click('#'+form.long[c]+'')
             if(form.long[c]=='long_other_id'){
                 browser
                   .isVisible('#longTermOtherText_id' , function(result){
                       if(result.value==true){
                        d=['Activity' , 'Work' , 'Sports']
                        lo_te=d[Math.floor(Math.random()*d.length)]
                        long_other.push(lo_te)
                             browser
                               .clearValue('#longTermOtherText_id')
                               .setValue('#longTermOtherText_id' , lo_te)
                       }
                   })
                
             }
        }

       browser
         .pause(500)
         .getLocationInView('#backToTop')
         .pause(500)
         .getLocationInView('#other_id')
         .pause(500)
         .click('button[onclick="return initialExamScreenEightValidation()"')
         .waitForElementVisible('button[onclick="addSoapNotes();"]' , 60000)
         .useXpath()
         .pause(500)
         .getLocationInView("//*[@id='treatmentformsContent']/div/a[text()='Initial Exam Screen 8 -']")
         .pause(500)
         .getLocationInView("//*[@id='treatmentformsContent']/div/a[text()='Initial Exam Screen 5 -']")
         .pause(500)
         .click("//*[@id='treatmentformsContent']/div/a[text()='Initial Exam Screen 8 -']")
         .useCss()
         .waitForElementVisible('button[onclick="gobackExamsList()"]' , 60000)
         .pause(500)


 },
'check' : function (browser){
	browser

  trt.sort();

var current = null;
var cnt = 0;
for (var i = 0; i < trt.length; i++) {
    if (trt[i] != current) {
        if (cnt > 0) {
           // console.log(current + ' comes --> ' + cnt + ' times<br>');
            if(cnt % 2 == 1){
      trt_11.push(current)
    }
        }
        current = trt[i];
        cnt = 1;
    } else {
        cnt++;
    }
}
if (cnt > 0) {
   // console.log(current + ' comes --> ' + cnt + ' times');
    if(cnt % 2 == 1){
      trt_11.push(current)
    }
}
//----------------------------------------------------------------------------------------------------------------
  shortT.sort();

var current = null;
var cnt = 0;
for (var i = 0; i < shortT.length; i++) {
    if (shortT[i] != current) {
        if (cnt > 0) {
           // console.log(current + ' comes --> ' + cnt + ' times<br>');
            if(cnt % 2 == 1){
      shortT_11.push(current)
    }
        }
        current = shortT[i];
        cnt = 1;
    } else {
        cnt++;
    }
}
if (cnt > 0) {
   // console.log(current + ' comes --> ' + cnt + ' times');
    if(cnt % 2 == 1){
      shortT_11.push(current)
    }
}
//----------------------------------------------------------------------------------------------------------------
  longT.sort();

var current = null;
var cnt = 0;
for (var i = 0; i < longT.length; i++) {
    if (longT[i] != current) {
        if (cnt > 0) {
           // console.log(current + ' comes --> ' + cnt + ' times<br>');
            if(cnt % 2 == 1){
      longT_11.push(current)
    }
        }
        current = longT[i];
        cnt = 1;
    } else {
        cnt++;
    }
}
if (cnt > 0) {
   // console.log(current + ' comes --> ' + cnt + ' times');
    if(cnt % 2 == 1){
      longT_11.push(current)
    }
}
//----------------------------------------------------------------------------------------------------------------
if((shortT_11.map(Number)).indexOf(5) > -1){
    shot_other_11.push(shot_other.pop())
}
if((longT_11.map(Number)).indexOf(3) > -1){
    long_other_11.push(long_other.pop())
}
//------------------------------------------------------------------------------------------------------------------
   
},
'Result':function(browser){
browser
     .verify.elementPresent('input[name="assessment"][value="'+asses_1+'"]')
     .verify.elementPresent('input[name="assessmentLevel"][value="'+asses_2+'"]')
     for(i=0; i<trt_11.length; i++){
      browser
        .verify.elementPresent('input[id='+form.treat[trt_11[i]]+']')
     }
for(i=0; i<shortT_11.length; i++){
      browser
        .verify.elementPresent('input[id='+form.short[shortT_11[i]]+'][checked="checked"]')
                 if(form.short[shortT_11[i]]=='other_id'){
                  browser
                        .verify.valueContains('#shortTermOtherText_id' , shot_other_11[0])
                 }
     }
     for(i=0; i<longT_11.length; i++){
      browser
        .verify.elementPresent('input[id='+form.long[longT_11[i]]+'][checked="checked"]')
             if(form.long[longT_11[i]]=='long_other_id'){
              browser
                    .verify.valueContains('#longTermOtherText_id' , long_other_11[0])
              }
     }
     browser
     .pause(500)
     .end()

 }
}

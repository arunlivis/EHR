var Data = require('../EHR_Json/data.json')

var tax;
var discount;
var id;
var total;
var initial_exam='99203'
var fee;
var bill_table;
var default_1;

module.exports={
    login : function (browser) {
        browser 
        .login(Data.user1[1].username, Data.user1[1].password)

},
'Billing':function(browser){
	a=Math.floor((Math.random()*6)+1)
    tax=a*5
	browser
	    .useXpath()
	    .pause(500)
	    .click("//*[@id='mainMenu']/ul/li[4]/a")
	    .pause(300)
	    .useCss()
	    .click('a[href="/EHR/Clinicadmin/ICDCodes"]')
	    .waitForElementVisible('#addnew' , 60000)
	    .pause(500)
},
'Add Tax':function(browser){
	browser
	    .pause(500)
	    .click('a[href="/EHR/Clinicadmin/viewTax"]')
	    .waitForElementVisible('#addnew' , 60000)
	    .pause(500)
	    .useXpath()
	    .getText("//*[@id='tax']/tbody/tr[1]/td[3]" , function(result){
	        default_1=result.value
	    })
	    .useCss()
	    .click('#addnew')
	    .waitForElementVisible('#taxName' , 60000)
	    .pause(500)
	    .clearValue('#taxName')
	    .setValue('#taxName' , 'service tax')
	    .clearValue('#description')
	    .setValue('#description' , 'tax')
	    .clearValue('#percentage')
	    .setValue('#percentage' , tax)
	    .pause(500)
	    .click('button[onclick="return saveTax();"]')
	    .waitForElementNotVisible('#taxName' , 60000)
	    .pause(500)
	    .click('a[class="green tooltipsclass"]')
	    .pause(500)
},
'Add Discount':function(browser){
	 b=Math.floor((Math.random()*6)+1)
     discount=b*5
	browser
	    .click('a[href="/EHR/Clinicadmin/viewDiscount"]')
	    .waitForElementVisible('#addnew' , 60000)
	    .pause(500)
	    .click('#addnew')
	    .waitForElementVisible('#discountNameId' , 60000)
	    .pause(500)
	    .clearValue('#discountNameId')
	    .setValue('#discountNameId' , 'offer')
	    .clearValue('#descriptionId')
	    .setValue('#descriptionId' , 'offer')
	    .clearValue('#percentageId')
	    .setValue('#percentageId' , discount)
	    .pause(500)
	    .click('button[onclick="return saveDiscount();"]')
	    .waitForElementNotVisible('#discountNameId' , 60000)
	    .pause(500)
},

'Open Patient':function(browser){
	browser
	    .useCss()
	    .pause(500)
	    .click('a[class="firstLevel"]')
	    .pause(500)
	    .click('a[href="/EHR/Clinicadmin/view-patient-details-open"]')
	    .waitForElementVisible('a[onclick="getPatientProfile()"]' , 60000)
	    .pause(500)
	    .waitForElementVisible('td[class="sorting_1"]' , 60000)
	    .pause(500)
	    .getText('td[class="sorting_1"]' , function(result){
	    	id=result.value
	    	browser
	    	   .click('a[onclick="postNavigateToProfile('+result.value+',1);"]')
	    	   .waitForElementVisible('#patient_first_name' , 60000)
	    	   .pause(500)
	    })
	    .click('a[onclick="doGetTreatments();"]')
	    .waitForElementVisible('button[onclick="openStartTreatment();"]' , 60000)
	    .pause(500)
	    .click('button[onclick="openStartTreatment();"]')
	    .waitForElementVisible('#startTreatmentModal' , 60000)
	    .pause(500)
	    .click('input[name="treatmentType"][value="1"]')
	    .pause(500)
	    .click('button[onclick="doStartTreatment()"]')
	    .waitForElementVisible('button[onclick="openStartTreatment();"]' , 60000)
	    .pause(300)
	    .click('button[onclick="openStartTreatment();"]')
	    .waitForElementVisible('#startTreatmentModal' , 60000)
	    .pause(1000)
	    .click('input[name="treatmentType"][value="1"]')
	    .pause(1000)
	    .click('button[onclick="doStartTreatment()"]')
	    .waitForElementVisible('button[onclick="openStartTreatment();"]' , 60000)
	    .pause(1000)
	    .elements('css selector', 'div#treatmentformsContent div', function(result) {
             total=result.value.length
        })
},
'Open Treatmentplan 1':function(browser){
	browser
	   .useXpath()
	   if(total>=5){
	   	browser
	   	.useCss()
	   	   .pause(1500)
	   	   .getLocationInView('#backToTop')
	   	   .pause(1500)
	   	   .useXpath()
	   	   .getLocationInView("//*[@id='treatmentformsContent']/div["+(total-4)+"]/span/button")
	   	   .pause(1500)
	   }
	   browser
	   .pause(500)
	   .click("//*[@id='treatmentformsContent']/div["+(total-1)+"]/span/button")
	   .pause(500)
	   .useCss()
	   .waitForElementVisible('button[onclick="addSoapNotes();"]' , 60000)
	   .pause(500)

	   .useXpath()
	   .click("//*[@id='treatmentformsContent']/div/a[text()='Initial Exam Screen 1 -']")
	   .useCss()
	    .waitForElementVisible('#btnExportTreatmentForm' , 60000)
	    .pause(500)
	    .getLocationInView('#areYouWorkingYes_id')
	    .pause(500)
	    .click('button[onclick="return initialExamScreenOneValidation();"]')
	    .pause(500)
	    .isVisible('#initialExamFormId' , function(result){
	    	if(result.value==true){
	    	browser
	    	  .useCss()
	    	  .pause(500)
	    	  .click('#initialExamFormId')
	    	  .pause(500)
	    	  .click('button[onclick="callExamFormFunction()"]')
	    	}
	    })
	    .useXpath()
	    .waitForElementVisible("//*[@id='treatmentformsContent']/div/a[text()='Initial Exam Screen 1 -']" , 60000)
	    .pause(500)
	    .getLocationInView("//*[@id='treatmentformsContent']/div/a[text()='Initial Exam Screen 8 -']")
	    .pause(500)
	    .getLocationInView("//*[@id='treatmentformsContent']/div/a[text()='Initial Exam Screen 5 -']")
	    .pause(500)
	    .click("//*[@id='treatmentformsContent']/div/a[text()='Initial Exam Screen 8 -']")
	    .useCss()
	    .waitForElementVisible('#diagnosisOne_id' , 60000)
	    .pause(500)
	    .getLocationInView('#longTermFullActivity_id')
	    .pause(500)
	    .click('button[onclick="return initialExamScreenEightValidation()"]')
	    .pause(500)
	    .useXpath()
	    .waitForElementVisible("//*[@id='treatmentformsContent']/div/a[text()='Initial Exam Screen 1 -']" , 60000)
	    .pause(500)
},
'Billing 2':function(browser){
	browser
	    .useXpath()
	    .pause(500)
	    .click("//*[@id='mainMenu']/ul/li[4]/a")
	    .pause(300)
	    .useCss()
	    .click('a[href="/EHR/Clinicadmin/ICDCodes"]')
	    .waitForElementVisible('#addnew' , 60000)
	    .pause(500)
},
'Remove Default Tax':function(browser){
	browser
	    .pause(500)
	    .click('a[href="/EHR/Clinicadmin/viewTax"]')
	    .waitForElementVisible('#addnew' , 60000)
	    .pause(500)
	    .click('a[class="green tooltipsclass"]')
},
'Open Treatmentplan 2':function(browser){
	browser
	.useCss()
	    .pause(500)
	    .click('a[class="firstLevel"]')
	    .pause(500)
	    .click('a[href="/EHR/Clinicadmin/view-patient-details-open"]')
	    .waitForElementVisible('a[onclick="getPatientProfile()"]' , 60000)
	    .pause(500)
	    .waitForElementVisible('a[onclick="postNavigateToProfile('+id+',1);"]' , 60000)
	    .pause(500)
	    .click('a[onclick="postNavigateToProfile('+id+',1);"]')
	    .waitForElementVisible('#patient_first_name' , 60000)
	    .pause(1000)
	    .click('a[onclick="doGetTreatments();"]')
	    .waitForElementVisible('button[onclick="openStartTreatment();"]' , 60000)
	    .useXpath()
	    .pause(500)
	   if(total>=5){
	   	browser
	   	   .pause(1500)
	   	   .useCss()
	   	   .getLocationInView('#backToTop')
	   	   .pause(1500)
	   	   .useXpath()
	   	   .getLocationInView("//*[@id='treatmentformsContent']/div["+(total-3)+"]/span/button")
	   	   .pause(1500)
	   }
	   browser
	   .click("//*[@id='treatmentformsContent']/div["+total+"]/span/button")
	   .pause(500)
	   .useCss()
	   .waitForElementVisible('button[onclick="addSoapNotes();"]' , 60000)
	   .pause(500)
	   .useXpath()
	   .click("//*[@id='treatmentformsContent']/div/a[text()='Initial Exam Screen 1 -']")
	   .useCss()
	    .waitForElementVisible('#btnExportTreatmentForm' , 60000)
	    .pause(500)
	    .getLocationInView('#areYouWorkingYes_id')
	    .pause(500)
	    .click('button[onclick="return initialExamScreenOneValidation();"]')
	    .pause(500)
	    .isVisible('#initialExamFormId' , function(result){
	    	if(result.value==true){
	    	browser
	    	  .useCss()
	    	  .pause(500)
	    	  .click('#initialExamFormId')
	    	  .pause(500)
	    	  .click('button[onclick="callExamFormFunction()"]')
	    	}
	    })
	    .useXpath()
	    .waitForElementVisible("//*[@id='treatmentformsContent']/div/a[text()='Initial Exam Screen 1 -']" , 60000)
	    .pause(500)
	    .getLocationInView("//*[@id='treatmentformsContent']/div/a[text()='Initial Exam Screen 8 -']")
	    .pause(500)
	    .getLocationInView("//*[@id='treatmentformsContent']/div/a[text()='Initial Exam Screen 5 -']")
	    .pause(500)
	    .click("//*[@id='treatmentformsContent']/div/a[text()='Initial Exam Screen 8 -']")
	    .useCss()
	    .waitForElementVisible('#diagnosisOne_id' , 60000)
	    .pause(500)
	    .getLocationInView('#longTermFullActivity_id')
	    .pause(500)
	    .click('button[onclick="return initialExamScreenEightValidation()"]')
	    .pause(500)
	    .useXpath()
	    .waitForElementVisible("//*[@id='treatmentformsContent']/div/a[text()='Initial Exam Screen 1 -']" , 60000)
	    .pause(500)
},
'Fee Schedule':function(browser){
	browser
	    .pause(500)
	    .useXpath()
	    .pause(500)
	    .click("//*[@id='mainMenu']/ul/li[4]/a")
	    .pause(300)
	    .useCss()
	    .click('a[href="/EHR/Clinicadmin/ICDCodes"]')
	    .waitForElementVisible('#addnew' , 60000)
	    .pause(500)
	    .click('a[href="/EHR/Clinicadmin/viewFeeSchedule"]')
	    .waitForElementVisible('input[placeholder="Search CPT Codes"]' , 60000)
	    .pause(500)
	    .setValue('input[placeholder="Search CPT Codes"]' , initial_exam)
	    .pause(500)
	    .useXpath()
	    .getText("//*[@id='feeschedule']/tbody/tr[2]/td[3]" , function(result){
	    	fee=result.value
	    })
},
'Open Patient 3':function(browser){
	a1=(parseInt(fee) / 100) * parseInt(tax)
	browser
	    .useCss()
	    .pause(500)
	    .click('a[class="firstLevel"]')
	    .pause(500)
	    .click('a[href="/EHR/Clinicadmin/view-patient-details-open"]')
	    .waitForElementVisible('a[onclick="getPatientProfile()"]' , 60000)
	    .pause(500)
	    .waitForElementVisible('a[onclick="postNavigateToProfile('+id+',1);"]' , 60000)
	    .pause(500)
	    .click('a[onclick="postNavigateToProfile('+id+',1);"]')
	    .waitForElementVisible('#patient_first_name' , 60000)
	    .pause(500)
	    .click('a[onclick="getBillingDetails();"]')
	    .waitForElementVisible('button[onclick="addPayment(1);"]' , 60000)
	    .pause(500)
	    .elements('css selector', 'table#billing tbody tr', function(result) {
	    	bill_table=result.value.length
            browser
               .useXpath()
               .pause(2500)
               .verify.containsText("//*[@id='billing']/tbody/tr["+(result.value.length-1)+"]/td[3]" , (parseInt(fee))+a1)
               .verify.containsText("//*[@id='billing']/tbody/tr["+result.value.length+"]/td[3]" , fee)

         })

},
'Change Discount':function(browser){
	a2=(parseInt(fee) / 100) * parseInt(default_1)
	if (a2==0){
		a3=fee
	}else{
		a2=a3
	}
	if(discount==0){
		a4=(parseInt(fee) / 100) * 1
	}else{
		a4=(parseInt(fee) / 100) * parseInt(discount)
	}
	browser
	    .pause(500)
	    if(bill_table>=5){
	    	browser
	    	  .useXpath()
	    	  .pause(500)
	    	  .getLocationInView("//*[@id='billing']/tbody/tr["+bill_table+"]/td[6]/a[1]")
	    	  .pause(500)
	    	  .getLocationInView("//*[@id='billing']/tbody/tr["+(bill_table-3)+"]/td[6]/a[1]")
	    	  .pause(500)
	    }
	    browser
	    .click("//*[@id='billing']/tbody/tr["+(bill_table-1)+"]/td[6]/a[1]")
	    .pause(500)
	    .useCss()
	    .waitForElementVisible('#btnSendBillForm' , 60000)
	    .pause(500)
	    .elements('css selector', 'table#table tbody tr', function(result) {
             browser
               .useXpath()
               .pause(500)
               .getLocationInView("//*[@id='consent-minor-form']/div/div[4]/div[4]/div/div[2]/span")
               .pause(500)
               .getLocationInView("//*[@id='action_"+result.value.length+"']/a")
               .pause(500)
         })
	    .pause(500)
	    .useCss()
	    .click('a[onclick="gettax()"]')
	    .waitForElementVisible('#taxModal' , 60000)
	    .pause(500)
	    .click('a[onclick="gettaxpercentage('+default_1+')"]')
	    .waitForElementNotVisible('#taxModal' , 60000)
	    .pause(500)
	    .useXpath()
	    .elements('css selector', 'table#table tbody tr', function(result) {
             browser
               .useXpath()
               .pause(500)
               .getLocationInView("//*[@id='consent-minor-form']/div/div[4]/div[4]/div/div[2]/span")
               .pause(500)
               .getLocationInView("//*[@id='action_"+result.value.length+"']/a")
               .pause(500)
         })
	    browser
	    .pause(1000)
	    .verify.containsText("//*[@id='consent-minor-form']/div/div[4]/div[4]/div/div[2]/span" , a3)
	    .useCss()
	    .pause(500)
	    .click('a[onclick="getDiscount()"]')
	    .waitForElementVisible('#discountModal' , 60000)
	    .pause(500)
	    .click('a[onclick="getDiscountPercentage('+discount+')"]')
	    .waitForElementNotVisible('#discountModal' , 60000)
	    .pause(1000)
	    .useXpath()
	    .verify.containsText("//*[@id='consent-minor-form']/div/div[4]/div[4]/div/div[2]/span" , a3-a4)
	    .pause(500)

},
'Delete added Tax and Discount' : function(browser){
	browser
        .useXpath()
        .pause(500)
        .click("//*[@id='mainMenu']/ul/li[4]/a")
        .pause(300)
        .useCss()
        .click('a[href="/EHR/Clinicadmin/ICDCodes"]')
        .waitForElementVisible('#addnew' , 60000)
        .pause(500)
        .click('a[href="/EHR/Clinicadmin/viewTax"]')
        .waitForElementVisible('#addnew' , 60000)
        .pause(500)
        .click('a[class="red tooltipsclass"]')
        .waitForElementVisible('#removeTax' , 60000)
        .pause(500)
        .click('#tax_delete_yes')
        .waitForElementNotVisible('#removeTax' , 60000)
        .pause(500)
        .click('a[href="/EHR/Clinicadmin/viewDiscount"]')
        .waitForElementVisible('#addnew' , 60000)
        .pause(500)
        .click('a[class="red tooltipsclass"]')
        .waitForElementVisible('#removediscount' , 60000)
        .pause(500)
        .click('#delete_yes')
        .waitForElementNotVisible('#removediscount' , 60000)
        .pause(1000)
        .end()

}
}
